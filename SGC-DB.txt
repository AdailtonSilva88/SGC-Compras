DROP DATABASE SGC_DB;
CREATE DATABASE SGC_DB;
USE SGC_DB;

CREATE TABLE TB_PRODUTO(
ID_PRODUTO INT PRIMARY KEY IDENTITY,
COD_PRODUTO INT NOT NULL,
DESCRICAO_PROD VARCHAR (30) NOT NULL
);

CREATE TABLE TB_FABRICANTE(
ID_FABRICANTE INT PRIMARY KEY IDENTITY,
COD_FABRICANTE INT NOT NULL,
NOME_FABRICANTE VARCHAR (30) NOT NULL
);

CREATE TABLE TB_UNIDADE(
ID_UNIDADE INT PRIMARY KEY IDENTITY,
COD_UNIDADE INT NOT NULL,
NOME_UNIDADE VARCHAR (30) NOT NULL
);

CREATE TABLE TB_ETAPA_PEDIDO(
ID_ETAPA_PEDIDO INT PRIMARY KEY IDENTITY,
NOME_ETAPA_PEDIDO VARCHAR (30) NOT NULL
);

CREATE TABLE TB_PEDIDO(
ID_PEDIDO INT PRIMARY KEY IDENTITY,
ID_FABRICANTE INT NOT NULL,
ID_ETAPA_PEDIDO INT NOT NULL,
PEDIDO_FABRICANTE VARCHAR (20) NOT NULL,
NOME_VENDEDOR VARCHAR(20),
DATA_PEDIDO SMALLDATETIME NOT NULL,
PREVISAO_FATURAMENTO SMALLDATETIME NOT NULL,
PRAZO INT NOT NULL,
PARCELA INT NOT NULL,
PEDIDO_COMPRADOR VARCHAR (20) NOT NULL,
ID_UNIDADE INT NOT NULL,
NF INT,
PED_STATUS VARCHAR(20),
NOME_COMPRADOR VARCHAR(20),
OBS VARCHAR(40),
FOREIGN KEY (ID_FABRICANTE) REFERENCES TB_FABRICANTE(ID_FABRICANTE),
FOREIGN KEY (ID_UNIDADE) REFERENCES TB_UNIDADE(ID_UNIDADE),
FOREIGN KEY (ID_ETAPA_PEDIDO) REFERENCES TB_ETAPA_PEDIDO(ID_ETAPA_PEDIDO)
);

CREATE TABLE TB_PRODUTOS_PEDIDO(
ID_PRODUTOS_PEDIDO INT PRIMARY KEY IDENTITY,
ID_PEDIDO INT NOT NULL,
ID_PRODUTO INT NOT NULL,
QTD_PEDIDO FLOAT,
SALDO_PEDIDO FLOAT,
VALOR FLOAT,
FOREIGN KEY (ID_PRODUTO) REFERENCES TB_PRODUTO(ID_PRODUTO),
FOREIGN KEY (ID_PEDIDO) REFERENCES TB_PEDIDO(ID_PEDIDO)
);

INSERT INTO TB_ETAPA_PEDIDO VALUES('Programação')
INSERT INTO TB_ETAPA_PEDIDO VALUES('Pedido')
INSERT INTO TB_ETAPA_PEDIDO VALUES('NF')


SELECT FAB.NOME_FABRICANTE,TP.PEDIDO_FABRICANTE, TP.PEDIDO_COMPRADOR,TP.NOME_COMPRADOR,TP.NOME_VENDEDOR,TP.PREVISAO_FATURAMENTO,TP.PRAZO,UNI.NOME_UNIDADE,ETA.NOME_ETAPA_PEDIDO,PR.DESCRICAO_PROD,PD.QTD_PEDIDO,PD.VALOR 
FROM TB_PEDIDO AS TP 
INNER JOIN TB_PRODUTOS_PEDIDO AS PD ON TP.ID_PEDIDO = PD.ID_PEDIDO
INNER JOIN TB_PRODUTO AS PR ON PD.ID_PRODUTO = PR.ID_PRODUTO 
INNER JOIN TB_FABRICANTE AS FAB ON FAB.ID_FABRICANTE = TP.ID_FABRICANTE
INNER JOIN TB_UNIDADE AS UNI ON UNI.ID_UNIDADE = TP.ID_UNIDADE
INNER JOIN TB_ETAPA_PEDIDO AS ETA ON ETA.ID_ETAPA_PEDIDO = TP.ID_ETAPA_PEDIDO

